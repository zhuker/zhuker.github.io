"use strict";var debugMode=!1;consoleLog("kamidoo loader - script is loaded");var widgetsServerName="https://widget.kamidoo.com",idResolverServer="https://widgetrenderer.kamidoo.com";function consoleLog(e){debugMode&&console.log(new Date+":"+(new Date).getTime()+"- "+e)}function getLocation(e){var o=new RegExp(["^(https?:)//","(([^:/?#]*)(?::([0-9]+))?)","(/{0,1}[^?#]*)","(\\?[^#]*|)","(#.*|)$"].join("")),t=e.match(o);return t&&{protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7]}}function hideLoading(e,o){var t=document.getElementById("k_loading_"+genIframeId(e,o));t&&t.setAttribute("style","display:none")}function kamidooReceiveMessage(e){var o="0px",t="700px",n=null,a=null;if(getLocation(e.origin).hostname==getLocation(widgetsServerName).hostname&&null!=e.data&&null!=e.data.userId&&null!=e.data.widgetId){consoleLog("kamidooReceiveMessage - Message from widget: "+JSON.stringify(e.data,null,0)),a=e.data.userId,n=e.data.widgetId;var i=document.getElementById(genIframeId(a,n));if(e.data.error||e.data.disableIframe)return hideLoading(a,n),i&&i.setAttribute("style","display:none!important;"),void window.removeEventListener("message",kamidooReceiveMessage);e.data.height&&(o=e.data.height,t=e.data.width||t,i&&(i.setAttribute("style","display:block !important; max-width:100%; width:"+t+"; border:none; margin-top: 10px; margin-bottom: 10px; overflow:hidden;-ms-overflow-style: none;height:"+o),i.scrolling="no"),hideLoading(a,n),consoleLog("kamidooReceiveMessage - done adjusting iframe"))}}function genIframeId(e,o){return e+"_"+o}function onKamidooWidgetLoaded(e,o){var t=document.getElementById("k_loading_"+genIframeId(e,o));t&&t.setAttribute("style","display:none")}function generateIframe(e,o,t,n){consoleLog("generateIframe of "+o+"_"+t);var a=genIframeId(o,t),i=n||"355px",d='<div id="k_loading_'+a+'" style="height: '+i+'; width: 100%;text-align: center;font-family: Arial, Helvetica, sans-serif;font-weight: 500;font-size: 14px;position: absolute;background: rgba(255, 255, 255, 0.69);"><div style="position: relative;top: 40%; direction:ltr;"><strong>Loading Infographic...</strong></div><div class="spinner"></div></div>',r='<iframe src="'+widgetsServerName+"/"+o+"/"+t+'" id="'+a+'" onload="onKamidooWidgetLoaded(\''+o+"', '"+t+'\')" style="display:block !important; max-width:100%; width: 700px; border:none; padding-top: 10px; padding-bottom: 10px; overflow:hidden;-ms-overflow-style: none;height: '+i+'" scrolling="no"></iframe>';e.innerHTML="<div style=\"position:relative\"><style>@keyframes spinner{to{transform:rotate(360deg)}}.spinner:before{content:'';box-sizing:border-box;position:absolute;top:50%;left:50%;width:20px;height:20px;margin-top:-10px;margin-left:-10px;border-radius:50%;border:2px solid #ccc;border-top-color:#333;animation:spinner .6s linear infinite</style>"+d+r+"</div>"}function callAjax(e,o){var t=new XMLHttpRequest;t.onreadystatechange=function(){4==t.readyState&&200==t.status&&o(t.responseText)},t.open("GET",e,!0),t.send()}function resolveIdAndGenerateIframe(e,o,t){consoleLog("resolveIdAndGenerateIframe - resolving Id");var n=document.location.href;callAjax(idResolverServer+"/api/ids/?user="+e+"&url="+encodeURIComponent(n),function(n){if(consoleLog("resolveIdAndGenerateIframe - response from id resolver"),n){var a=JSON.parse(n);a&&a.Id?(consoleLog("resolveIdAndGenerateIframe - response from id resolver - Id found"),generateIframe(o,e,a.Id,t)):consoleLog("resolveIdAndGenerateIframe - response from id resolver - Id not found1. Done")}else consoleLog("resolveIdAndGenerateIframe - response from id resolver - Id not found2. Done")})}window.addEventListener("message",kamidooReceiveMessage);var kamidooInit=!1;function onDocumentReady(){if(consoleLog("onDocumentReady"),kamidooInit)consoleLog("onDocumentReady - kamidoo was already initialized");else{kamidooInit=!0;for(var e=document.getElementsByClassName("kamidoo_widget"),o=0;o<e.length;o++)if(consoleLog("onDocumentReady - found kamidoo_widget"),""==e[o].innerHTML){consoleLog("onDocumentReady - kamidoo_widget is empty, generate iframe");var t=e[o].getAttribute("widget-id"),n=e[o].getAttribute("widget-by"),a=e[o].getAttribute("height");n&&(t?generateIframe(e[o],n,t,a):resolveIdAndGenerateIframe(n,e[o],a))}else consoleLog("onDocumentReady - widget was already generated")}}document.addEventListener("DOMContentLoaded",function(e){consoleLog("DOMContentLoaded event"),onDocumentReady()}),document.addEventListener("load",onDocumentReady);